BINARY=prwd

OBJECTS=alias.o \
	branch.o \
	config.o \
	date.o \
	hostname.o \
	main.o \
	path-cut.o \
	path-newsgroupize.o \
	path.o \
	strdelim.o \
	template-arglist.o \
	template-exec.o \
	template-render.o \
	template-tokenize.o \
	template-variable.o \
	uid.o \
	utils.o \
	wgetopt.o
OBJECTS+=${EXTRA_OBJECTS}

CFLAGS?=--std=c99 -Wall

all: ${BINARY}

${BINARY}: ${OBJECTS}
	$(CC) -o ${BINARY} ${OBJECTS}

afl-template: ${OBJECTS}
	$(CC) ${CFLAGS} -c afl-template.c -o main.o
	$(CC) ${CFLAGS} ${LDFLAGS} -o afl-template ${OBJECTS}

run-afl-template: afl-template
	mkdir -p afl-findings/templates
	afl-fuzz -i afl-testcases/templates -o afl-findings/templates ./afl-template

run_tests: ${OBJECTS}
	$(CC) ${CFLAGS} -D REGRESS -c path.c -o path.o
	$(CC) ${CFLAGS} -D REGRESS -c utils.c -o utils.o
	$(CC) ${CFLAGS} -D REGRESS -c test.c -o main.o
	$(CC) ${CFLAGS} ${LDFLAGS} -o run_tests ${OBJECTS}

test: run_tests run_tests.sh
	./run_tests.sh

force-test: run_tests
	./run_tests

clean:
	rm -f ${BINARY} ${OBJECTS}

.PHONY: clean test all
